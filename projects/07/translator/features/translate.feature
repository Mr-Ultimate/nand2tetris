Feature: Translate a vm file into an asm file
  In order to abstract hardware implementation from higher level code
  As a hack system developer
  I want to compile vm code into assembly code

  Scenario: I can translate an empty file
    Given an empty file named "source.vm"
    When I run `translate source.vm`
    Then the stdout should contain "Translated the contents of \"source.vm\" to \"source.asm\"."
    And the exit status should be 0

  Scenario: I can translate a directory of empty files
    Given an empty file named "vm_files/source.vm"
    And an empty file named "vm_files/source2.vm"
    When I run `translate vm_files`
    Then the stdout should contain "Translated the contents of \"vm_files\" to \"vm_files.asm\"."
    And the exit status should be 0

  Scenario: Simple Add
    Given a file derived from project file "StackArithmetic/SimpleAdd/SimpleAdd.vm"
    When I run `translate SimpleAdd.vm`
    Then a file named "SimpleAdd.asm" should exist
    And the file "SimpleAdd.asm" should contain exactly:
      """
      @7
      D=A
      @SP
      AM=M+1
      A=A-1
      M=D
      @8
      D=A
      @SP
      AM=M+1
      A=A-1
      M=D
      @SP
      AM=M-1
      D=M
      A=A-1
      M=D+M

      """

  Scenario: Stack Test
    Given a file derived from project file "StackArithmetic/StackTest/StackTest.vm"
    When I run `translate StackTest.vm`
    Then a file named "StackTest.asm" should exist
    And the file "StackTest.asm" should contain exactly:
"""
@17
D=A
@SP
AM=M+1
A=A-1
M=D
@17
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_EQ_StackTest_9
D;JNE
@SP
A=M-1
M=-1
(END_EQ_StackTest_9)
@17
D=A
@SP
AM=M+1
A=A-1
M=D
@16
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_EQ_StackTest_12
D;JNE
@SP
A=M-1
M=-1
(END_EQ_StackTest_12)
@16
D=A
@SP
AM=M+1
A=A-1
M=D
@17
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_EQ_StackTest_15
D;JNE
@SP
A=M-1
M=-1
(END_EQ_StackTest_15)
@892
D=A
@SP
AM=M+1
A=A-1
M=D
@891
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_LT_StackTest_18
D;JGE
@SP
A=M-1
M=-1
(END_LT_StackTest_18)
@891
D=A
@SP
AM=M+1
A=A-1
M=D
@892
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_LT_StackTest_21
D;JGE
@SP
A=M-1
M=-1
(END_LT_StackTest_21)
@891
D=A
@SP
AM=M+1
A=A-1
M=D
@891
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_LT_StackTest_24
D;JGE
@SP
A=M-1
M=-1
(END_LT_StackTest_24)
@32767
D=A
@SP
AM=M+1
A=A-1
M=D
@32766
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_GT_StackTest_27
D;JLE
@SP
A=M-1
M=-1
(END_GT_StackTest_27)
@32766
D=A
@SP
AM=M+1
A=A-1
M=D
@32767
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_GT_StackTest_30
D;JLE
@SP
A=M-1
M=-1
(END_GT_StackTest_30)
@32766
D=A
@SP
AM=M+1
A=A-1
M=D
@32766
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
D=M-D
M=0
@END_GT_StackTest_33
D;JLE
@SP
A=M-1
M=-1
(END_GT_StackTest_33)
@57
D=A
@SP
AM=M+1
A=A-1
M=D
@31
D=A
@SP
AM=M+1
A=A-1
M=D
@53
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
M=D+M
@112
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
M=M-D
@SP
A=M-1
M=-M
@SP
AM=M-1
D=M
A=A-1
M=M&D
@82
D=A
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
M=M|D
@SP
A=M-1
M=!M

"""

  Scenario: Memory Access Basic Test
    Given a file derived from project file "MemoryAccess/BasicTest/BasicTest.vm"
    When I run `translate BasicTest.vm`
    Then a file named "BasicTest.asm" should exist
    And the file "BasicTest.asm" should contain exactly:
"""
@10
D=A
@SP
AM=M+1
A=A-1
M=D
@0
D=A
@LCL
D=M+D
@R15
M=D
@SP
AM=M-1
D=M
@R15
A=M
M=D
@21
D=A
@SP
AM=M+1
A=A-1
M=D
@22
D=A
@SP
AM=M+1
A=A-1
M=D
@2
D=A
@ARG
D=M+D
@R15
M=D
@SP
AM=M-1
D=M
@R15
A=M
M=D
@1
D=A
@ARG
D=M+D
@R15
M=D
@SP
AM=M-1
D=M
@R15
A=M
M=D
@36
D=A
@SP
AM=M+1
A=A-1
M=D
@6
D=A
@THIS
D=M+D
@R15
M=D
@SP
AM=M-1
D=M
@R15
A=M
M=D
@42
D=A
@SP
AM=M+1
A=A-1
M=D
@45
D=A
@SP
AM=M+1
A=A-1
M=D
@5
D=A
@THAT
D=M+D
@R15
M=D
@SP
AM=M-1
D=M
@R15
A=M
M=D
@2
D=A
@THAT
D=M+D
@R15
M=D
@SP
AM=M-1
D=M
@R15
A=M
M=D
@510
D=A
@SP
AM=M+1
A=A-1
M=D
@6
D=A
@5
D=A+D
@R15
M=D
@SP
AM=M-1
D=M
@R15
A=M
M=D
@0
D=A
@LCL
A=M+D
D=M
@SP
AM=M+1
A=A-1
M=D
@5
D=A
@THAT
A=M+D
D=M
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
M=D+M
@1
D=A
@ARG
A=M+D
D=M
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
M=M-D
@6
D=A
@THIS
A=M+D
D=M
@SP
AM=M+1
A=A-1
M=D
@6
D=A
@THIS
A=M+D
D=M
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
M=D+M
@SP
AM=M-1
D=M
A=A-1
M=M-D
@6
D=A
@5
A=A+D
D=M
@SP
AM=M+1
A=A-1
M=D
@SP
AM=M-1
D=M
A=A-1
M=D+M

"""
